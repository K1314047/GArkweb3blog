---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_TITLE } from '../../consts';

const allPosts = await getCollection('blog');
const categoriesMap = new Map();

// 统计每个分类的文章数量
allPosts.forEach((post) => {
	if (post.data.categories) {
		post.data.categories.forEach((category) => {
			categoriesMap.set(category, (categoriesMap.get(category) || 0) + 1);
		});
	}
});

// 按文章数量排序
const sortedCategories = Array.from(categoriesMap.entries()).sort((a, b) => b[1] - a[1]);
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title="分类" description="浏览所有文章分类" />
	</head>
	<body>
		<Header />
		<main>
			<p></p>
			<h2>–</h2>
			<h1>分类</h1>
			<p>共 {sortedCategories.length} 个分类</p>
			<div class="post-content content">
				<div class="categories-grid">
					{
						sortedCategories.map(([category, count]) => (
							<a href={`/categories/${category}/`} class="category-item">
								{category}
								sup>({count})</sup>
							</a>
						))
					}
				</div>
			</div>
		</main>
		<Footer />
	</body>
</html>


---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_TITLE } from '../../consts';

const allPosts = await getCollection('blog');
const tagsMap = new Map();

// 统计每个标签的文章数量
allPosts.forEach((post) => {
	if (post.data.tags) {
		post.data.tags.forEach((tag) => {
			tagsMap.set(tag, (tagsMap.get(tag) || 0) + 1);
		});
	}
});

// 按文章数量排序
const sortedTags = Array.from(tagsMap.entries()).sort((a, b) => b[1] - a[1]);
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title="标签" description="浏览所有文章标签" />
	</head>
	<body>
		<Header />
		<main>
			<p></p>
			<h2>–</h2>
			<h1>标签</h1>
			<p>共 {sortedTags.length} 个标签</p>
			<div class="post-content content">
				<div class="tags">
					{
						sortedTags.map(([tag, count]) => (
							<a href={`/tags/${tag}/`}>
								{tag}
								<sup>({count})</sup>
							</a>
						))
					}
				</div>
			</div>
		</main>
		<Footer />
	</body>
</html>


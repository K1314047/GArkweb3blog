---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';

import { filterDrafts } from '../../utils/drafts';

// 排除英文文章（en/ 前缀），避免中英文标签混在一起
const allPosts = filterDrafts(await getCollection('blog')).filter((post) => !post.id.startsWith('en/'));
const tagsMap = new Map();

// 统计每个标签的文章数量
allPosts.forEach((post) => {
	if (post.data.tags) {
		post.data.tags.forEach((tag) => {
			tagsMap.set(tag, (tagsMap.get(tag) || 0) + 1);
		});
	}
});

// 按文章数量排序
const sortedTags = Array.from(tagsMap.entries()).sort((a, b) => b[1] - a[1]);
---

<Base title='标签' description='浏览所有文章标签'>
	<p></p>
	<h2>–</h2>
	<h1>标签</h1>
	<p>共 {sortedTags.length} 个标签</p>
	<div class='post-content content'>
		<div class='tags'>
			{
				sortedTags.map(([tag, count]) => (
					<a href={`/tags/${tag}/`}>
						{tag}
						<sup>({count})</sup>
					</a>
				))
			}
		</div>
	</div>
</Base>

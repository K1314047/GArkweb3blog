---
import Base from '../layouts/Base.astro';
import SimpleHeader from '../components/SimpleHeader.astro';
import Tabs from '../components/Tabs.astro';
import TabItem from '../components/TabItem.astro';
import MediaCard from '../components/MediaCard.astro';
import neodbData from '../data/neodb.json';

const title = "书影音";
const description = "记录看过的书、电影和玩过的游戏";

    interface NeoDBItem {
        uuid: string;
        item: {
            title: string;
            cover_image_url: string;
            brief: string;
            rating: number;
            url?: string;
        };
        comment_text: string;
        rating_grade: number;
        created_time: string;
        shelf_type?: string;
    }

// Helper to sort items by creation date (newest first)
const sortItems = (items: NeoDBItem[]) => {
    return items.sort((a, b) => new Date(b.created_time).getTime() - new Date(a.created_time).getTime());
};

const books = sortItems((neodbData.book || []) as NeoDBItem[]);
const movies = sortItems((neodbData.movie || []) as NeoDBItem[]);
const tvs = sortItems((neodbData.tv || []) as NeoDBItem[]); // Add TV shows
const games = sortItems((neodbData.game || []) as NeoDBItem[]);
---

<Base title={title} description={description} useCard={false} hideHeader={true} fullWidth={true}>
    <SimpleHeader title="Media" description={description} />
    
    <div class="content-limit-width">
        <Tabs>
            <TabItem label="书籍">
                <div class="media-grid">
                    {books.length > 0 ? books.map(item => (
                        <MediaCard 
                            title={item.item.title}
                            cover={item.item.cover_image_url}
                            rating={item.rating_grade}
                            neodbRating={item.item.rating}
                            brief={item.item.brief}
                            comment={item.comment_text}
                            date={item.created_time}
                            link={`https://neodb.social${item.item.url || '#'}`}
                            status={item.shelf_type}
                        />
                    )) : <p>暂无书籍记录。</p>}
                </div>
            </TabItem>
            
            <TabItem label="电影">
                <div class="media-grid">
                    {movies.length > 0 ? movies.map(item => (
                        <MediaCard 
                            title={item.item.title}
                            cover={item.item.cover_image_url}
                            rating={item.rating_grade}
                            neodbRating={item.item.rating}
                            brief={item.item.brief}
                            comment={item.comment_text}
                            date={item.created_time}
                            link={`https://neodb.social${item.item.url || '#'}`}
                            status={item.shelf_type}
                        />
                    )) : <p>暂无电影记录。</p>}
                </div>
            </TabItem>
            
            <TabItem label="剧集">
                <div class="media-grid">
                    {tvs.length > 0 ? tvs.map(item => (
                        <MediaCard 
                            title={item.item.title}
                            cover={item.item.cover_image_url}
                            rating={item.rating_grade}
                            neodbRating={item.item.rating}
                            brief={item.item.brief}
                            comment={item.comment_text}
                            date={item.created_time}
                            link={`https://neodb.social${item.item.url || '#'}`}
                            status={item.shelf_type}
                        />
                    )) : <p>暂无剧集记录。</p>}
                </div>
            </TabItem>
            
            <TabItem label="游戏">
                <div class="media-grid">
                    {games.length > 0 ? games.map(item => (
                        <MediaCard 
                            title={item.item.title}
                            cover={item.item.cover_image_url}
                            rating={item.rating_grade}
                            neodbRating={item.item.rating}
                            brief={item.item.brief}
                            comment={item.comment_text}
                            date={item.created_time}
                            link={`https://neodb.social${item.item.url || '#'}`}
                            status={item.shelf_type}
                        />
                    )) : <p>暂无游戏记录。</p>}
                </div>
            </TabItem>
        </Tabs>
    </div>
</Base>

<style>
    .media-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }
    
    @media (max-width: 600px) {
        .media-grid {
            grid-template-columns: 1fr;
        }
    }

    .content-limit-width {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
        box-sizing: border-box;
        width: 100%;
    }
    
    @media (max-width: 600px) {
        .content-limit-width {
             padding: 0 1.5rem;
        }
    }
</style>
